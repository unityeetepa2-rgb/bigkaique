<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BIGKAIQUE ‚Äî Webcam no Navegador</title>
  <meta name="description" content="Site BIGKAIQUE para acessar e visualizar a webcam diretamente no navegador." />
  <style>
    :root{
      --bg:#0b0f14;--card:#121826;--muted:#9aa4b2;--accent:#2dd4bf;--text:#e5e7eb;--danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial,sans-serif; background:linear-gradient(180deg,#0b0f14,#0e1523 60%,#0b0f14); color:var(--text);}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:16px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:42px;height:42px;border-radius:12px;background:radial-gradient(circle at 30% 30%, #34d399, #06b6d4 60%, #2563eb); box-shadow:0 10px 30px rgba(37,99,235,.35)}
    h1{font-size:clamp(22px,3.6vw,32px);margin:0;letter-spacing:.5px}
    .card{background:rgba(18,24,38,.8); border:1px solid rgba(255,255,255,.05); border-radius:18px; padding:16px; backdrop-filter: blur(8px); box-shadow: 0 6px 24px rgba(0,0,0,.35)}
    .controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin:14px 0}
    label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
    select, input[type="number"], button{width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#0f172a; color:#e5e7eb}
    select:focus, input:focus, button:focus{outline:2px solid var(--accent);outline-offset:2px}
    .row{display:flex;gap:12px; flex-wrap:wrap}
    .row > *{flex:1 1 180px}
    .btn{cursor:pointer; font-weight:600}
    .btn.primary{background:linear-gradient(90deg,#06b6d4,#22d3ee); color:#062329; border:none}
    .btn.stop{background:linear-gradient(90deg,#f43f5e,#ef4444); color:white; border:none}
    .btn.ghost{background:transparent; border:1px dashed rgba(255,255,255,.18)}
    .video-wrap{position:relative; border-radius:16px; overflow:hidden; background:#020617; aspect-ratio:16/9; display:grid; place-items:center}
    video{max-width:100%; width:100%; height:100%; object-fit:cover; transform: scaleX(1);}
    .mirrored video{transform: scaleX(-1)}
    .badge{position:absolute; top:10px; left:10px; background:rgba(0,0,0,.55); padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid rgba(255,255,255,.08)}
    .status{font-size:13px; color:var(--muted); margin-top:10px}
    footer{opacity:.8; font-size:12px; margin-top:16px; text-align:center}
    .hidden{display:none}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#0b1220;border:1px solid rgba(255,255,255,.08)}
    .danger{color:#fecaca}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>BIGKAIQUE ‚Äî Acesso √† Webcam</h1>
      </div>
      <div class="pill" title="Funciona melhor em HTTPS (ex.: GitHub Pages)">üîí Precisa de permiss√£o do navegador</div>
    </header>

    <section class="card">
      <div class="controls">
        <div>
          <label for="cameraSelect">C√¢mera</label>
          <select id="cameraSelect"></select>
        </div>
        <div>
          <label for="resolution">Resolu√ß√£o</label>
          <select id="resolution">
            <option value="default">Autom√°tica</option>
            <option value="1280x720">1280√ó720 (HD)</option>
            <option value="1920x1080">1920√ó1080 (FullHD)</option>
            <option value="640x480">640√ó480 (VGA)</option>
          </select>
        </div>
        <div>
          <label for="fps">FPS desejado</label>
          <input id="fps" type="number" min="1" max="60" step="1" value="30" />
        </div>
        <div>
          <label>&nbsp;</label>
          <button id="startBtn" class="btn primary">‚ñ∂Ô∏è Iniciar c√¢mera</button>
        </div>
        <div>
          <label>&nbsp;</label>
          <button id="stopBtn" class="btn stop" disabled>‚èπÔ∏è Parar</button>
        </div>
        <div>
          <label>&nbsp;</label>
          <button id="snapshotBtn" class="btn ghost" disabled>üì∏ Capturar foto</button>
        </div>
        <div>
          <label>&nbsp;</label>
          <button id="fullscreenBtn" class="btn ghost" disabled>‚õ∂ Tela cheia</button>
        </div>
        <div>
          <label for="mirrorToggle">Espelhar imagem</label>
          <select id="mirrorToggle">
            <option value="on" selected>Ligado</option>
            <option value="off">Desligado</option>
          </select>
        </div>
      </div>

      <div id="videoContainer" class="video-wrap mirrored">
        <span class="badge" id="badge">C√¢mera parada</span>
        <video id="video" playsinline autoplay muted></video>
      </div>
      <div class="status" id="status">Pronto. Clique em ‚ÄúIniciar c√¢mera‚Äù e permita o acesso quando solicitado.</div>
    </section>

    <section class="card" style="margin-top:16px">
      <h2 style="margin:0 0 8px 0; font-size:18px">Foto capturada</h2>
      <div class="row">
        <canvas id="canvas" class="hidden" aria-label="Pr√©via da foto"></canvas>
        <a id="downloadLink" class="btn ghost" download="bigkaique-foto.png">‚¨áÔ∏è Baixar foto</a>
        <button id="clearPhoto" class="btn ghost">üóëÔ∏è Limpar</button>
      </div>
    </section>

    <footer>
      Feito com ‚ù§Ô∏è para <strong>BIGKAIQUE</strong>. Funciona em Chrome, Edge, Firefox e Safari recentes. Necessita HTTPS (ou localhost).
    </footer>
  </div>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const cameraSelect = document.getElementById('cameraSelect');
    const resolution = document.getElementById('resolution');
    const fpsInput = document.getElementById('fps');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const snapshotBtn = document.getElementById('snapshotBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const statusEl = document.getElementById('status');
    const downloadLink = document.getElementById('downloadLink');
    const clearPhotoBtn = document.getElementById('clearPhoto');
    const badge = document.getElementById('badge');
    const videoContainer = document.getElementById('videoContainer');
    const mirrorToggle = document.getElementById('mirrorToggle');

    let stream = null;

    function setStatus(text, isError=false){
      statusEl.textContent = text;
      statusEl.style.color = isError ? 'var(--danger)' : 'var(--muted)';
    }

    function buildConstraints(){
      const fps = Number(fpsInput.value) || 30;
      let width, height;
      const r = resolution.value;
      if(r !== 'default'){
        const [w, h] = r.split('x').map(Number);
        width = w; height = h;
      }
      const deviceId = cameraSelect.value || undefined;
      const videoConstraints = {
        frameRate: { ideal: fps, max: 60 },
      };
      if(width && height){ videoConstraints.width = { exact: width }; videoConstraints.height = { exact: height }; }
      if(deviceId){ videoConstraints.deviceId = { exact: deviceId }; }
      return { audio:false, video: videoConstraints };
    }

    async function listCameras(){
      try{
        const devices = await navigator.mediaDevices.enumerateDevices();
        const cams = devices.filter(d => d.kind === 'videoinput');
        cameraSelect.innerHTML = '';
        cams.forEach((c, i)=>{
          const opt = document.createElement('option');
          opt.value = c.deviceId;
          opt.textContent = c.label || `C√¢mera ${i+1}`;
          cameraSelect.appendChild(opt);
        });
        if(cams.length === 0){
          const opt = document.createElement('option');
          opt.textContent = 'Nenhuma c√¢mera encontrada';
          cameraSelect.appendChild(opt);
        }
      }catch(e){
        console.error(e);
      }
    }

    async function startCamera(){
      try{
        stopCamera();
        setStatus('Solicitando acesso √† c√¢mera‚Ä¶');
        const constraints = buildConstraints();
        stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;
        await video.play();
        startBtn.disabled = true;
        stopBtn.disabled = false;
        snapshotBtn.disabled = false;
        fullscreenBtn.disabled = false;
        badge.textContent = 'Ao vivo';
        await listCameras();
        setStatus('C√¢mera ativa. Dica: mude a resolu√ß√£o ou a c√¢mera no topo.');
      }catch(err){
        console.error(err);
        let msg = 'Erro ao acessar a webcam. ';
        if(location.protocol !== 'https:' && location.hostname !== 'localhost'){
          msg += 'Este recurso exige HTTPS (ou localhost).';
        } else if(err.name === 'NotAllowedError'){
          msg += 'Permiss√£o negada. Verifique as permiss√µes do site no cadeado da barra de endere√ßo.';
        } else if(err.name === 'NotFoundError'){
          msg += 'Nenhuma c√¢mera foi encontrada.';
        } else if(err.name === 'OverconstrainedError'){
          msg += 'A resolu√ß√£o escolhida n√£o √© suportada pela sua c√¢mera.';
        } else {
          msg += err.message || String(err);
        }
        setStatus(msg, true);
        badge.textContent = 'C√¢mera parada';
        startBtn.disabled = false;
        stopBtn.disabled = true;
        snapshotBtn.disabled = true;
        fullscreenBtn.disabled = true;
      }
    }

    function stopCamera(){
      if(stream){
        stream.getTracks().forEach(t => t.stop());
        stream = null;
      }
      video.srcObject = null;
      startBtn.disabled = false;
      stopBtn.disabled = true;
      snapshotBtn.disabled = true;
      fullscreenBtn.disabled = true;
      badge.textContent = 'C√¢mera parada';
      setStatus('C√¢mera parada.');
    }

    function snapshot(){
      if(!stream) return;
      const track = stream.getVideoTracks()[0];
      const settings = track.getSettings();
      const w = settings.width || video.videoWidth || 1280;
      const h = settings.height || video.videoHeight || 720;
      canvas.width = w; canvas.height = h;

      const ctx = canvas.getContext('2d');
      // respeita espelhamento
      const mirrored = mirrorToggle.value === 'on';
      if(mirrored){
        ctx.translate(w, 0);
        ctx.scale(-1,1);
      }
      ctx.drawImage(video, 0, 0, w, h);
      canvas.classList.remove('hidden');
      canvas.style.maxWidth = '100%';
      canvas.style.borderRadius = '12px';
      downloadLink.href = canvas.toDataURL('image/png');
    }

    function clearPhoto(){
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width,canvas.height);
      canvas.classList.add('hidden');
      downloadLink.removeAttribute('href');
    }

    function toggleMirror(){
      const mirrored = mirrorToggle.value === 'on';
      videoContainer.classList.toggle('mirrored', mirrored);
    }

    async function handleDeviceChange(){
      await listCameras();
    }

    function toggleFullscreen(){
      const el = videoContainer;
      if(!document.fullscreenElement){
        el.requestFullscreen?.();
      }else{
        document.exitFullscreen?.();
      }
    }

    startBtn.addEventListener('click', startCamera);
    stopBtn.addEventListener('click', stopCamera);
    snapshotBtn.addEventListener('click', snapshot);
    clearPhotoBtn.addEventListener('click', clearPhoto);
    fullscreenBtn.addEventListener('click', toggleFullscreen);
    cameraSelect.addEventListener('change', startCamera);
    resolution.addEventListener('change', startCamera);
    fpsInput.addEventListener('change', startCamera);
    mirrorToggle.addEventListener('change', toggleMirror);

    if('mediaDevices' in navigator){
      navigator.mediaDevices.addEventListener?.('devicechange', handleDeviceChange);
      listCameras();
    }else{
      setStatus('Seu navegador n√£o suporta acesso √† c√¢mera via getUserMedia.', true);
    }
  </script>
</body>
</html>
